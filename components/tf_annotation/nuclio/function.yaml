metadata:
  name: tf_faster_rcnn_inception_resnet_v2_atrous_coco
  namespace: cvat

spec:
  description: TF Object Detection API (faster RCNN)
  runtime: "python:3.6"
  handler: main:handler
  eventTimeout: 30s

  build:
    image: cvat/tf_faster_rcnn_inception_resnet_v2_atrous_coco
    baseImage: tensorflow/tensorflow:2.0.1-py3

    directives:
    preCopy:
      - kind: RUN
        value: apt install curl
      - kind: WORKDIR
        value: /opt/nuclio

    postCopy:
      - kind: RUN
        value: curl http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_coco_2018_01_28.tar.gz -o model.tar.gz
      - kind: RUN
        value: tar -xzf model.tar.gz && rm model.tar.gz
      - kind: RUN
        value: ln -s faster_rcnn_inception_resnet_v2_atrous_coco_2018_01_28 rcnn
      - kind: RUN
        value: ln -s rcnn/frozen_inference_graph.pb rcnn/inference_graph.pb

  triggers:
    myHttpTrigger:
      maxWorkers: 2
      kind: "http"
      workerAvailabilityTimeoutMilliseconds: 10000
